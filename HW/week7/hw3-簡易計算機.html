<html>
<head>
	<title>ç°¡æ˜“è¨ˆç®—æ©Ÿ</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<style type="text/css">
		*{
			box-sizing: border-box;
		}
		body {
			background: lightslategrey;
			font-family: 'Overpass Mono', monospace;
		}
		.main {
			height: 100%;
			display: flex;
			justify-content: center;
			align-items: center;
		}
		.calculator {
			min-width: 320px;
			background: #ddd;
			padding: 10px 0;
			box-shadow: 0 0 20px 0px rgba(0,0,0,0.1);
			border-radius: 5px;
		}
		.calculator.error {
			border: 1px solid red;
		}
		.calculator h2 {
			color: #999;
			font-size: 16px;
			font-weight: normal;
			text-align: center;
			margin: 10px 0;
		}
		.row__result {
			height: 100;
			padding: 0 15px;
			display: flex;
			background: #666;
			justify-content: space-evenly;
			align-items: flex-end;
			color: #fff;
			font-size: 24px;
			letter-spacing: 0.2em;
			border-top: 20px solid #1da5a5;
			border-bottom: 4px solid #e2b156;
			flex-flow: column nowrap;
		}
		.row__result span {
			font-size: 13px;
			color: #999;
		}
		.list {
			padding-inline-start: 0;
			list-style: none;
			border-top: 1px solid #ddd;
		}
		.row__key {
			display: flex;
			border-bottom: 1px solid #ddd;
		}
		.row__key span {
			display: inline-block;
			height: 50px;
			background: #fff;
			color: #666;
			justify-content: space-between;
			flex: 0 0 22%;
			display: flex;
		    justify-content: center;
		    align-items: center;
		    cursor: pointer;
		    transition: all 0.3s;
		}
/* 
ä¸Šé¢çš„ display: inline-block; è¨­å®šçš„æ˜¯æ¯å€‹æŒ‰éˆ•çš„å¤–æ¡†
ä¸‹é¢çš„ display: flex; è¨­å®šçš„æ˜¯æ¯å€‹æ¡†è£¡é¢æ•¸å­—çš„ä½ç½®
flex: 0 0 22%  flex å¢é•· , flex æ”¶ç¸®,  flex åŸºç¤ 
*/
		.row__key span:not(:last-child) {
			border-right: 1px solid #ddd;
		}
/*
:not(:last-child) æœ€å³é‚Šçš„å…ƒç´ ä¸è¦é¸ï¼Œå…¶ä»–éƒ½é¸
*/
		.row__key span:hover {
			background: #eee;
			border-bottom: 1px solid #aaa;
			box-shadow: inset 0 0 0px 1px rgba(255,255,255,0.6);
		}
/*
box-shadow: inset é€™é‚Šçš„é™°å½±æ˜¯å‡¹é€²å»çš„!
*/
		.row__key .col__1 {
			flex-grow: 1;
		}
		.row__key .col__2 {
			flex-grow: 9.5;
		}
		.row__key .col__3 {
			flex-grow: 18;
		}
		.row__key .btn--grey {
			background: darkcyan;
			color: #fff;
		}
		.row__key .btn--grey:hover {
			background: #088282;
			box-shadow: none;
		}
		.row__key span:active {
			background: #ccc;
		}
/*
é€™é‚Šçš„ :hover è·Ÿ :active éƒ½è¦åŒæ™‚è¨­å®šï¼Œä¸ç„¶æ»‘é¼ ç§»åˆ° = éµä¸Šæ–¹çš„æ™‚å€™é¡è‰²æœƒè·‘æ‰ï¼Œä½†æ˜¯ç‚ºä»€éº¼æœƒé€™æ¨£æˆ‘ç›®å‰ä¸çŸ¥é“ã€‚
*/

	</style>
</head>
<body>
	<main class="main">
		<div class="calculator animated fast">
			<h2>calculator</h2>
			<div class="row__result">
				<span></span>
				<strong>0</strong>
			</div>
			<ul class="list">
				<li class="row__key">
					<span data-value="AC" class="col__3">AC</span>
					<span data-value="/" class="col__1">/</span>
				</li>
				<li class="row__key">
					<span data-value="7" class="col__1">7</span>
					<span data-value="8" class="col__1">8</span>
					<span data-value="9" class="col__1">9</span>
					<span data-value="*" class="col__1">*</span>
				</li>
				<li class="row__key">
					<span data-value="4" class="col__1">4</span>
					<span data-value="5" class="col__1">5</span>
					<span data-value="6" class="col__1">6</span>
					<span data-value="-" class="col__1">-</span>
				</li>
				<li class="row__key">
					<span data-value="1" class="col__1">1</span>
					<span data-value="2" class="col__1">2</span>
					<span data-value="3" class="col__1">3</span>
					<span data-value="+" class="col__1">+</span>
				</li>
				<li class="row__key">
					<span data-value="0" class="col__2">0</span>
					<span data-value="." class="col__1">.</span>
					<span data-value="=" class="col__1 btn--grey">=</span>
				</li>
			</ul>
		</div>
	</main>
</body>
<script type="text/javascript">
	const inputResultTop = document.querySelector('.row__result span');
	const inputResult = document.querySelector('.row__result strong');
	const calculator = document.querySelector('.calculator');
	const numFixed = 5; //å°æ•¸é»å¾Œ5ä½åˆªæ‰

	const numManage = {  //æ•¸å€¼ç®¡ç†
		numOrigin: '',
		numResult: '',
	};
	const signManage = {  //ç¬¦è™Ÿç®¡ç†
		calcSignAll: ['+', '-', '*', '/'],
		calcSignCurrent: '',
	};
	const stateManage = {  //ç‹€æ…‹ç®¡ç†
		isCalculated: false,  //å·²ç¶“é»éé‹ç®—ç¬¦è™Ÿ
		isFinish: false,
		isClickCalc: false,
	};

	const funManage = {    //å‡½å¼ç®¡ç†
		dataProcess: value => ((value[0] === '0' && value[1] !== '.' && value.length !== 1) ? value.substr(1) : value), 
		// å‰”é™¤æ‰æ˜¯ 0 é–‹é ­ï¼Œä½†æ²’å°æ•¸é»çš„æƒ…æ³
		calc: (subValue, mainValue) => {
			if(Number.isNaN(mainValue)){
				showResult(showError(['0','å“å‘€æœ‰è‡­èŸ² ğŸ¤¢']))
			} else {
				const result = [funManage.dataProcess(subValue), funManage.dataProcess(mainValue)]
				if(stateManage.isFinish && mainValue % 1) result[1] = funManage.isFloat(mainValue);
				[inputResultTop.innerText, inputResult.innerText] = result
			}
		},
		// å…ˆå°‡ç®—å¼è·Ÿç­”æ¡ˆå…©å€‹éƒ¨åˆ†åˆ†åˆ¥æ¨é€² result é™£åˆ—è£¡ï¼Œå†åˆ¤æ–·ç­”æ¡ˆçš„éƒ¨åˆ†æ˜¯ä¸æ˜¯å°æ•¸ï¼Œæœ€å¾Œå°‡ç®—å¼é¡¯ç¤ºæ–¼ spanï¼Œå°‡ç­”æ¡ˆé¡¯ç¤ºæ–¼ strong 
		isFloat: (mainValue) => {
			const num = mainValue.toString();
			if(num.split('.')[1].length < numFixed) return mainValue;
			return Number(num).toFixed(numFixed)
		},
		// å°‡ç­”æ¡ˆè½‰æˆå­—ä¸²ï¼Œåˆ¤æ–·å°æ•¸é»å¾Œæ˜¯å¦è¶…é 5 ä½ï¼Œè¶…éçš„éƒ¨åˆ†åˆªæ‰
		doCalc: (sign, first, sec) => {
			switch(sign) {
				case '+':
					return first + sec;
				case '-':
					return first - sec;
				case '*':
					return first * sec;
				case '/':
					if(sec === 0){
						return this.showError('ç„¡æ„ç¾© ğŸ§â€')
					}return first / sec;
				default:
				break;
			};
			return false;
		},
		// å°‡ åŠ ,æ¸›,ä¹˜,é™¤ åšè™•ç†ï¼Œåˆ¤æ–·é™¤æ³•åˆ†æ¯ä¸å¯ä»¥ç‚º 0 
	};
	// click - æ­¸é›¶ (AC)
	function clickReset(msg) {
		[stateManage.isCalculated, stateManage.isFinish] = [false, false];
		[numManage.numOrigin, numManage.numResult] = ['', '']
		if(msg) return msg;
		return ['0', '0']
	}
	// click - ç­‰æ–¼ (=)
	function clickResult() {
		stateManage.isCalculated = false;
		stateManage.isFinish = true;
		const arr = numManage.numOrigin.split(signManage.calcSignCurrent);
		const numFir = Number(arr[0]);
		const numSec = Number(arr[1].substring(0, arr[1].length - 1));
		numManage.numResult = funManage.doCalc(signManage.calcSignCurrent, numFir, numSec);
		return [numManage.numOrigin, numManage.numResult];
	}
	// click - åŠ ,æ¸›,ä¹˜,é™¤ (+,-,*,/)
	function clickCalc(sign) {
		signManage.calcSignCurrent = sign;
		if(numManage.numResult) numManage.numOrigin = numManage.numResult + sign;
		if(stateManage.isCalculated) return showError('0', 'å“å‘€æœ‰è‡­èŸ² ğŸ¤¢');
		stateManage.isCalculated = true;
		return [numManage.numOrigin, sign];
	}
	//	show éŒ¯èª¤
	function showError(msg) {
		calculator.classList.add('shake');
		return clickReset(msg);
	}
	// show çµæœ
	function showResult(arr) {
		if(!arr && numManage.numResult) showResult(showError());
		else if(!arr) funManage.calc(numManage.numOrigin, numManage.numOrigin);
		else funManage.calc(arr[0], arr[1]);
	}
	// å·²æœ‰é‹ç®—ç¬¦è™Ÿçš„è™•ç†ï¼Œåªé¡¯ç¤ºå¾Œä¾†çš„æ•¸å­—
	function showMainNum(value) {
		if(numManage.numResult){
			numManage.numOrigin = numManage.numResult + signManage.calcSignCurrent + value;
			numManage.numResult = '';
			stateManage.isCalculated = true;
		}
		const index = numManage.numOrigin.indexOf(signManage.calcSignCurrent);
		return [numManage.numOrigin, numManage.numOrigin.substr(index + 1)]
	}

	calculator.addEventListener('click', (e) => {
		calculator.classList.remove('shake');
		const value = e.target.getAttribute('data-value');
		stateManage.isClickCalc = signManage.calcSignAll.some(sign => value === sign);
		if(value === null) return;

		numManage.numOrigin += value;

		if(value === 'AC') showResult(clickReset());
		else if(stateManage.isClickCalc) showResult(clickCalc(value));
		else if(value === '=')showResult(clickResult());
		else if(stateManage.isCalculated) showResult(showMainNum(value));
		else showResult() // æŒ‰æ•¸å­—
	})

</script>
</html>